{% extends "PublicBundle:Global:base_index.html.twig" %}

{% block head %}
    {{ parent() }}
    <style>
        .user-login-5 .alert { margin-top: -5px; }
    </style>
{% endblock %}

{% block pageLevelPlugins %}
    {% stylesheets output='css/login/pageLevelPlugins.css'
        '@PublicBundle/Resources/public/metronic/assets/global/plugins/select2/css/select2.min.css'
        '@PublicBundle/Resources/public/metronic/assets/global/plugins/select2/css/select2-bootstrap.min.css'
    %}
    <link rel="stylesheet" href="{{ asset_url }}" type="text/css" />
    {% endstylesheets %}
{% endblock %}

{% block pageLevelStyles %}
    <link rel="stylesheet" href="{{ asset(METRONIC_PAGES~'css/login-5.min.css') }}" type="text/css" />
{% endblock %}
{% block content %}
<body class="login">
    <div class="user-login-5">
        <div class="row bs-reset">
            <div class="col-md-6 bs-reset">
                <div class="login-bg" style="background-image:url({{ asset('bundles/public/images/login/bg1.jpg') }})">
                    <img class="login-logo" src="{{ asset('bundles/public/images/logo130_32.png') }}" /> </div>
            </div>
            <div class="col-md-6 login-container bs-reset">
                <div class="login-content">
                    <h1> 上海悦维工具系统登录 </h1>
                    <form action="{{ path('loginCheck') }}" class="login-form" method="post">
                        <div class="alert alert-danger display-hide login-alert">
                            <button class="close" data-close="alert"></button>
                            <span> 请输入您的用户名和密码 </span>
                        </div>
                        <div class="row">
                            <div class="col-xs-6">
                                <input class="form-control form-control-solid placeholder-no-fix form-group" type="text" autocomplete="off" placeholder="用户名" name="_username" value="{{ last_username }}" required/> </div>
                            <div class="col-xs-6">
                                <input class="form-control form-control-solid placeholder-no-fix form-group" type="password" autocomplete="off" placeholder="密码" name="_password" required/> </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-4">
                                <div class="rem-password">
                                    <label class="rememberme mt-checkbox mt-checkbox-outline">
                                        <input type="checkbox" name="_remember_me" value="1" /> 记住我
                                        <span></span>
                                    </label>
                                </div>
                            </div>
                            <div class="col-sm-8 text-right">
                                <div class="forgot-password">
                                    <a href="javascript:;" id="forget-password" class="forget-password"> 忘记密码 </a>
                                </div>
                                <button class="btn green login-btn" type="button"> 登录 </button>
                            </div>
                        </div>
                    </form>
                    <!-- BEGIN FORGOT PASSWORD FORM -->
                    <form class="forget-form" action="javascript:;" method="post">
                        <h3 class="font-green"> 忘记密码 </h3>
                        <div class="alert forget-alert">
                            <p> 输入您的电子邮件地址来重置您的密码 </p>
                        </div>
                        <div class="form-group">
                            <input class="form-control placeholder-no-fix form-group" type="text" autocomplete="off" placeholder="邮箱地址" name="email" /> </div>
                        <div class="form-actions">
                            <button type="button" id="back-btn" class="btn green btn-outline"> 返回 </button>
                            <button type="button" class="btn btn-success uppercase pull-right forgetPasswd-btn"> 提交 </button>
                        </div>
                    </form>
                    <!-- END FORGOT PASSWORD FORM -->
                </div>
                <div class="login-footer">
                    <div class="row bs-reset">
                        <div class="col-xs-5 bs-reset">
                            {#<ul class="login-social">#}
                                {#<li>#}
                                    {#<a href="javascript:;">#}
                                        {#<i class="icon-social-facebook"></i>#}
                                    {#</a>#}
                                {#</li>#}
                                {#<li>#}
                                    {#<a href="javascript:;">#}
                                        {#<i class="icon-social-twitter"></i>#}
                                    {#</a>#}
                                {#</li>#}
                                {#<li>#}
                                    {#<a href="javascript:;">#}
                                        {#<i class="icon-social-dribbble"></i>#}
                                    {#</a>#}
                                {#</li>#}
                            {#</ul>#}
                        </div>
                        <div class="col-xs-7 bs-reset">
                            <div class="login-copyright text-right">
                                <p> Copyright © {{ "now" | date("Y") }} 技术支持：上海悦维技术部 {% include "PublicBundle::Footer/version.html.twig" %} </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascript %}
    {{ parent() }}
{% endblock %}

{% block pageLevelPluginsScript %}
    {% javascripts filter='jsqueeze' output='js/login/pageLevelPlugins.js'
        '@PublicBundle/Resources/public/metronic/assets/global/plugins/jquery-validation/js/jquery.validate.min.js'
        '@PublicBundle/Resources/public/metronic/assets/global/plugins/jquery-validation/js/additional-methods.min.js'
        '@PublicBundle/Resources/public/metronic/assets/global/plugins/select2/js/select2.full.min.js'
        '@PublicBundle/Resources/public/metronic/assets/global/plugins/backstretch/jquery.backstretch.min.js'
    %}
    <script src="{{ asset_url }}" type="text/javascript"></script>
    {% endjavascripts %}
{% endblock %}

{% block pageLevelScripts %}
    <script src="{{ asset(METRONIC_PAGES~'scripts/login-5.min.js') }}" type="text/javascript"></script>
    <script type="text/javascript">
        $(function(){
            {% if errorMsg %}
            $('.login-alert').fadeIn().find('span').html('{{ errorMsg }}');
            {% endif %}
            $(document).on('click', '.login-btn', function () {
                var errorFlag = true;
                $('.login-form input').each(function (index, el) {
                    if ($(this).val() == '') {
                        $(this).focus();
                        errorFlag = false;
                        return false;
                    }
                });
                errorFlag ? $(this).attr('type', 'submit') : $('.login-alert').fadeIn().find('span').html('请输入您的用户名和密码！');
            });
            $(document).on('click', '.forgetPasswd-btn', function (event) {
                var email = $('input[name="email"]').val();
                if(!email.match(/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/)) {
                    $('.forget-alert').attr('class', 'alert forget-alert alert-danger').find('p').html(' 邮箱格式不正确！请重新输入 ');
                    $('input[name="email"]').focus();
                } else {
                    $.ajax({
                        url: '{{ path('forgetPassword') }}',
                        type: 'post',
                        dataType: 'json',
                        data: {'email': email},
                    }).done(function (data) {
                        var _data = data.state ? 'alert-success' : 'alert-danger'
                        $('.forget-alert').attr('class', 'alert forget-alert ' + _data).find('p').html(' ' + data.msg + ' ');
                    }).fail(function () {
                        console.log("未知错误！");
                    })
                }
            });

        })
    </script>
{% endblock %}
